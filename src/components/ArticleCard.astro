---
/**
 * ArticleCard Component
 * 
 * Displays a blog/writing entry in a card format with metadata, title, description, and tags.
 * Extends BaseCard component with article-specific formatting and automatically generates
 * links to the full article page.
 * 
 * @component
 * 
 * @example
 * ```astro
 * <ArticleCard
 *   title="Getting Started with Astro"
 *   slug="getting-started-astro"
 *   description="Learn how to build fast websites with Astro"
 *   publishDate={new Date('2024-01-15')}
 *   tags={['astro', 'web-development', 'tutorial']}
 * />
 * ```
 */

import BaseCard from './BaseCard.astro';
import ForwardLink from './ForwardLink.astro';

interface Props {
  /** Article title (displayed as card heading) */
  title: string;
  
  /** URL slug for the article (used to generate /writing/{slug} link) */
  slug: string;
  
  /** Brief description or excerpt of the article */
  description: string;
  
  /** Publication date (formatted as "Month Day, Year") */
  publishDate: Date;
  
  /** Optional array of tags/categories for the article */
  tags?: string[];

  /** Optional base path for article links (defaults to /writing) */
  basePath?: string;

  /** Whether to display the featured badge (default: false) */
  featured?: boolean;

  /** Article status (default: 'published') */
  status?: 'published' | 'ongoing' | 'archived';
}

const {
  title,
  slug,
  description,
  publishDate,
  tags = [],
  basePath = '/writing',
  featured = false,
  status: statusProp,
} = Astro.props as Props;

const normalizedBasePath = basePath.endsWith('/') ? basePath.slice(0, -1) : basePath;
const articleHref = `${normalizedBasePath}/${slug}`;

const statusConfig: Record<'published' | 'ongoing' | 'archived', { class: string }> = {
  published: { class: 'status--published' },
  ongoing: { class: 'status--ongoing' },
  archived: { class: 'status--archived' },
};
const status = statusProp;
const statusClass = status ? statusConfig[status].class : undefined;

/**
 * Formats a date object into a human-readable string
 * 
 * Uses US English locale with long month format.
 * Example output: "January 15, 2024"
 * 
 * @param date - The date to format
 * @returns Formatted date string in "Month Day, Year" format
 */
function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}
---

<BaseCard href={articleHref} class="article-card">
  <div slot="badge" class="card-badges">
    {featured && (
      <span class="featured-badge">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
        Featured
      </span>
    )}
    {status && (
      <span class:list={['status-badge', statusClass]}>
        {status}
      </span>
    )}
  </div>
  <Fragment slot="meta">{formatDate(publishDate)}</Fragment>
  <Fragment slot="title">{title}</Fragment>
  <Fragment slot="description">{description}</Fragment>
  
  {tags.length > 0 && (
    <div slot="tags" class="tags-list">
      {tags.map((tag) => (
        <span class="tag">{tag}</span>
      ))}
    </div>
  )}
  
  <ForwardLink text="Read article" />
</BaseCard>

<style>
  .card-badges {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .card-badges:empty {
    display: none;
  }

  .featured-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-accent);
  }

  .featured-badge svg {
    flex-shrink: 0;
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    font-size: 0.625rem;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
  }

  .status--ongoing {
    background: rgba(34, 197, 94, 0.15);
    color: #22c55e;
  }

  .status--archived {
    background: rgba(115, 115, 115, 0.15);
    color: var(--color-text-muted);
  }

  .status--published {
    background: rgba(59, 130, 246, 0.15);
    color: #3b82f6;
  }
</style>
