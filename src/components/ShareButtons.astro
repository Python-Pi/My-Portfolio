---
import { Icon } from 'astro-icon/components';

interface Props {
  title: string;
  description?: string;
  url: string;
}

const { title, description, url } = Astro.props;
const resolvedDescription = description?.trim() || title;
const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);
const encodedSummary = encodeURIComponent(`${resolvedDescription}\n\n${url}`);
const shareTargets = [
  {
    key: 'facebook',
    label: 'Share on Facebook',
    href: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
    icon: 'mdi:facebook'
  },
  {
    key: 'twitter',
    label: 'Share on Twitter',
    href: `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}`,
    icon: 'mdi:twitter'
  },
  {
    key: 'whatsapp',
    label: 'Share on WhatsApp',
    href: `https://wa.me/?text=${encodeURIComponent(`${title} - ${url}`)}`,
    icon: 'mdi:whatsapp'
  },
  {
    key: 'telegram',
    label: 'Share on Telegram',
    href: `https://t.me/share/url?url=${encodedUrl}&text=${encodedTitle}`,
    icon: 'mdi:telegram'
  },
  {
    key: 'email',
    label: 'Share via Email',
    href: `mailto:?subject=${encodedTitle}&body=${encodedSummary}`,
    icon: 'mdi:email-outline'
  }
];
---

<section class="share-block" aria-labelledby="share-heading">
  <hr class="share-divider" />
  <div class="share-inner">
    <h2 class="share-heading" id="share-heading">Share this article</h2>
    <div class="share-buttons">
      {shareTargets.map((target) => (
        <a
          class="share-button"
          href={target.href}
          target={target.key === 'email' ? undefined : '_blank'}
          rel={target.key === 'email' ? undefined : 'noopener noreferrer'}
          aria-label={target.label}
        >
          <Icon name={target.icon} aria-hidden="true" class="share-icon" />
        </a>
      ))}
    </div>
  </div>
</section>

<style>
  .share-block {
    margin: 3rem 0 2rem;
  }

  .share-divider {
    border: none;
    border-top: 1px solid var(--color-border);
    margin: 0 0 1.75rem;
  }

  .share-inner {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .share-heading {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text);
  }

  .share-buttons {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .share-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: transform 0.2s ease, color 0.2s ease;
  }

  .share-button:hover,
  .share-button:focus-visible {
    color: var(--color-text);
    transform: translateY(-1px);
  }

  .share-icon {
    width: 1.25rem;
    height: 1.25rem;
  }

  @media (max-width: 600px) {
    .share-heading {
      font-size: 1.125rem;
    }
  }
</style>
