---
/**
 * ArticleLayout
 *
 * Specialized layout for blog posts and article detail pages. Extends BaseLayout
 * with article-specific typography, spacing, and content styling optimized for
 * long-form reading experiences.
 *
 * Features:
 * - Optimized reading width (800px max)
 * - Enhanced typography for readability
 * - Comprehensive MDX content styling (headings, lists, blockquotes, code, tables)
 * - Article header with meta information support
 * - Tag display styling
 * - Syntax highlighting for code blocks
 * - Responsive design for mobile devices
 *
 * Expected content structure:
 * - .article-header: Contains h1, meta info, and tags
 * - .article-content: Main article body with MDX content
 * - .back-link: Navigation back to article list
 *
 * Note: SEO meta tags should be handled by the SEO component in each page
 * using the "head" slot, not passed as props to this layout.
 *
 * @component
 *
 * @example
 * ```astro
 * ---
 * import ArticleLayout from '../layouts/ArticleLayout.astro';
 * import SEO from '../components/SEO.astro';
 * ---
 *
 * <ArticleLayout>
 *   <SEO
 *     slot="head"
 *     title="Getting Started with Astro"
 *     description="A comprehensive guide to building fast websites"
 *   />
 *   <div class="article-header">
 *     <h1>Getting Started with Astro</h1>
 *     <div class="article-meta">
 *       <time>January 15, 2024</time>
 *       <span class="meta-separator">Â·</span>
 *       <span>5 min read</span>
 *     </div>
 *   </div>
 *
 *   <div class="article-content">
 *     <!-- MDX content here -->
 *   </div>
 * </ArticleLayout>
 * ```
 */

import BaseLayout from "./BaseLayout.astro";
---

<BaseLayout>
  <slot name="head" slot="head" />
  <div class="article-layout">
    <slot />
  </div>

  <style>
    .article-layout {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-2xl) var(--space-lg);
    }

    .article-layout :global(.article-header) {
      margin-bottom: var(--space-3xl);
      padding-bottom: var(--space-2xl);
      border-bottom: 1px solid var(--color-border);
    }

    .article-layout :global(.article-header h1) {
      font-size: var(--font-size-5xl);
      margin-bottom: var(--space-md);
      font-weight: var(--font-weight-bold);
      letter-spacing: -0.02em;
      line-height: var(--line-height-tight);
    }

    .article-layout :global(.article-meta) {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-md);
    }

    .article-layout :global(.meta-separator) {
      opacity: 0.5;
    }

    .article-layout :global(.article-tags) {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }

    .article-layout :global(.tag) {
      font-size: var(--font-size-xs);
      padding: var(--space-xs) var(--space-sm);
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-sm);
      color: var(--color-text-secondary);
    }

    .article-layout :global(.article-content) {
      font-size: var(--font-size-lg);
      line-height: var(--line-height-relaxed);
      color: var(--color-text);
    }

    .article-layout :global(.article-content h2) {
      font-size: var(--font-size-4xl);
      margin-top: var(--space-3xl);
      margin-bottom: var(--space-md);
      font-weight: var(--font-weight-bold);
      letter-spacing: -0.01em;
      line-height: var(--line-height-tight);
    }

    .article-layout :global(.article-content h3) {
      font-size: var(--font-size-3xl);
      margin-top: var(--space-2xl);
      margin-bottom: var(--space-sm);
      font-weight: var(--font-weight-semibold);
      letter-spacing: -0.01em;
      line-height: var(--line-height-tight);
    }

    .article-layout :global(.article-content h4) {
      font-size: var(--font-size-2xl);
      margin-top: var(--space-xl);
      margin-bottom: var(--space-sm);
      font-weight: var(--font-weight-semibold);
      line-height: var(--line-height-normal);
    }

    .article-layout :global(.article-content p) {
      margin-bottom: var(--space-lg);
      color: var(--color-text-secondary);
    }

    .article-layout :global(.article-content ul),
    .article-layout :global(.article-content ol) {
      margin-bottom: var(--space-md);
      padding-left: var(--space-xl);
    }

    .article-layout :global(.article-content li) {
      margin-bottom: var(--space-xs);
      line-height: var(--line-height-normal);
      color: var(--color-text-secondary);
    }

    .article-layout :global(.article-content blockquote) {
      margin: var(--space-2xl) 0;
      padding: var(--space-md) var(--space-lg);
      border-left: 4px solid var(--color-accent);
      background: rgba(255, 255, 255, 0.02);
      font-style: italic;
      color: var(--color-text-secondary);
    }

    .article-layout :global(.article-content blockquote p) {
      margin-bottom: var(--space-sm);
    }

    .article-layout :global(.article-content blockquote p:last-child) {
      margin-bottom: 0;
    }

    .article-layout :global(.article-content code) {
      font-family:
        ui-monospace, "JetBrains Mono", "Cascadia Code", Menlo, Consolas,
        "Courier New", monospace;
      font-size: 0.9em;
      background: rgba(255, 255, 255, 0.05);
      padding: 0.2em 0.4em;
      border-radius: var(--border-radius-sm);
      color: var(--color-text);
    }

    .article-layout :global(.article-content pre) {
      margin: var(--space-2xl) 0;
      padding: var(--space-lg);
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-md);
      overflow-x: auto;
      line-height: 1.35;
    }

    .article-layout :global(.article-content pre code) {
      background: none;
      padding: 0;
      font-size: var(--font-size-sm);
      line-height: inherit;
    }

    .article-layout :global(.article-content a) {
      color: var(--color-accent);
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 2px;
      transition: all 0.2s ease;
    }

    .article-layout :global(.article-content a:hover) {
      color: var(--color-accent-hover);
      text-decoration-thickness: 2px;
    }

    .article-layout :global(.article-content img) {
      max-width: 100%;
      height: auto;
      border-radius: var(--border-radius-md);
      margin: var(--space-2xl) 0;
    }

    .article-layout :global(.article-content hr) {
      margin: var(--space-3xl) 0;
      border: none;
      border-top: 1px solid var(--color-border);
    }

    .article-layout :global(.article-content strong),
    .article-layout :global(.article-content b) {
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
    }

    .article-layout :global(.article-content em),
    .article-layout :global(.article-content i) {
      font-style: italic;
    }

    .article-layout :global(.article-content table) {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-2xl) 0;
    }

    .article-layout :global(.article-content th),
    .article-layout :global(.article-content td) {
      padding: var(--space-sm) var(--space-md);
      text-align: left;
      border-bottom: 1px solid var(--color-border);
    }

    .article-layout :global(.article-content th) {
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
    }

    .article-layout :global(.article-content td) {
      color: var(--color-text-secondary);
    }

    @media (max-width: 768px) {
      .article-layout {
        padding: var(--space-xl) var(--space-md);
      }

      .article-layout :global(.article-header h1) {
        font-size: var(--font-size-4xl);
      }

      .article-layout :global(.article-content) {
        font-size: var(--font-size-base);
      }

      .article-layout :global(.article-content h2) {
        font-size: var(--font-size-3xl);
      }

      .article-layout :global(.article-content h3) {
        font-size: var(--font-size-2xl);
      }

      .article-layout :global(.article-content h4) {
        font-size: var(--font-size-xl);
      }

      .article-layout :global(.article-content pre) {
        padding: var(--space-md);
      }
    }

    /* Copy Button Styles */
    .article-layout :global(.code-block-wrapper) {
      position: relative;
    }

    .article-layout :global(.copy-button) {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      color: var(--color-text-secondary);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.25rem;
      cursor: pointer;
      opacity: 0;
      transition: all 0.2s ease;
    }

    .article-layout :global(.code-block-wrapper:hover .copy-button) {
      opacity: 1;
    }

    .article-layout :global(.copy-button:hover) {
      background: rgba(255, 255, 255, 0.2);
      color: var(--color-text);
    }

    .article-layout :global(.copy-button.copied) {
      background: var(--color-accent);
      color: white;
      border-color: var(--color-accent);
    }
  </style>

  <script>
    function addCopyButtons() {
      const preBlocks = document.querySelectorAll(".article-content pre");

      preBlocks.forEach((pre) => {
        // Wrap pre in a relative container if not already wrapped
        const parent = pre.parentNode as HTMLElement;
        if (parent?.classList.contains("code-block-wrapper")) return;

        const wrapper = document.createElement("div");
        wrapper.className = "code-block-wrapper";
        parent?.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);

        // Create button
        const button = document.createElement("button");
        button.className = "copy-button";
        button.textContent = "Copy";
        button.setAttribute("aria-label", "Copy code to clipboard");

        // Add click handler
        button.addEventListener("click", async () => {
          const code = pre.querySelector("code");
          const text =
            (code as HTMLElement)?.innerText || (pre as HTMLElement).innerText;

          try {
            await navigator.clipboard.writeText(text);
            button.textContent = "Copied!";
            button.classList.add("copied");

            setTimeout(() => {
              button.textContent = "Copy";
              button.classList.remove("copied");
            }, 2000);
          } catch (err) {
            console.error("Failed to copy:", err);
            button.textContent = "Error";
          }
        });

        wrapper.appendChild(button);
      });
    }

    // Run on initial load
    addCopyButtons();

    // Run on view transitions if enabled
    document.addEventListener("astro:page-load", addCopyButtons);
  </script>
</BaseLayout>
